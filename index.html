<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KBJU Tracker</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { 
            background-color: var(--tg-theme-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #000000);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            -webkit-user-select: none; 
            user-select: none; 
        }
        .card { background-color: var(--tg-theme-secondary-bg-color, #ffffff); border-radius: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn-primary { background-color: var(--tg-theme-button-color, #3b82f6); color: white; }
        
        /* –õ–æ–∞–¥–µ—Ä */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3b82f6; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* –ö–æ–Ω—Å–æ–ª—å –æ—à–∏–±–æ–∫ */
        #error-console { display: none; background: #000; color: #ff4444; padding: 10px; font-size: 10px; margin-bottom: 10px; border-radius: 8px; font-family: monospace; }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±–µ–∑ —Ä–∞–º–æ–∫ */
        input[type="date"] {
            background: transparent; font-size: 1.1rem; font-weight: bold;
            color: var(--tg-theme-text-color, #374151); border: none; outline: none; font-family: inherit;
        }
    </style>
</head>
<body class="p-4 pb-24">

    <!-- üî¥ –ö–û–ù–°–û–õ–¨ –û–®–ò–ë–û–ö -->
    <div id="error-console">ERRORS:<br></div>

    <!-- ‚è≥ –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="loader mb-4"></div>
        <div class="text-sm text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button onclick="forceStart()" class="mt-8 text-blue-500 text-xs underline opacity-60">–ó–∞–≤–∏—Å? –ù–∞–∂–º–∏ —Å—é–¥–∞</button>
    </div>

    <!-- üì± –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù -->
    <div id="main-app" class="hidden">
        
        <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨: –î–ê–¢–ê –ò –ù–ê–°–¢–†–û–ô–ö–ò -->
        <div class="flex justify-between items-center mb-4 card p-3">
            <div class="flex items-center gap-2">
                <span class="text-xl">üìÖ</span>
                <input type="date" id="datePicker" onchange="changeDate()">
            </div>
            <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
            <button onclick="openSettings()" class="p-2 opacity-60 active:scale-90 transition-transform">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            </button>
        </div>

        <!-- –ö–†–£–ì –ò –ü–û–õ–û–°–ö–ò -->
        <div class="card p-5 mb-6 relative">
            <div class="relative h-40 flex justify-center mb-4">
                <canvas id="caloriesChart"></canvas>
                <div class="absolute inset-0 flex items-center justify-center flex-col pt-4">
                    <span id="calLeft" class="text-3xl font-bold">0</span>
                    <span class="text-xs opacity-50 uppercase">–∫–∫–∞–ª –æ—Å—Ç.</span>
                </div>
            </div>
            <!-- –ü–æ–ª–æ—Å–∫–∏ –ë–ñ–£ -->
            <div class="grid grid-cols-3 gap-2 text-center text-xs">
                <div>
                    <div class="font-bold opacity-60 mb-1">–ë–ï–õ–ö–ò</div>
                    <div class="h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"><div id="barP" class="h-full bg-blue-500 w-0"></div></div>
                    <div class="mt-1"><span id="valP">0</span>/<span id="goalP">0</span></div>
                </div>
                <div>
                    <div class="font-bold opacity-60 mb-1">–ñ–ò–†–´</div>
                    <div class="h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"><div id="barF" class="h-full bg-yellow-500 w-0"></div></div>
                    <div class="mt-1"><span id="valF">0</span>/<span id="goalF">0</span></div>
                </div>
                <div>
                    <div class="font-bold opacity-60 mb-1">–£–ì–õ–ò</div>
                    <div class="h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"><div id="barC" class="h-full bg-green-500 w-0"></div></div>
                    <div class="mt-1"><span id="valC">0</span>/<span id="goalC">0</span></div>
                </div>
            </div>
        </div>

        <!-- –°–ü–ò–°–û–ö –ï–î–´ (–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º) -->
        <div id="mealsContainer" class="space-y-4 pb-10"></div>
        <div id="emptyMsg" class="text-center opacity-40 text-sm mt-10 hidden">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç. –ü–æ–∫—É—à–∞–π! üòã</div>

        <!-- –ö–ù–û–ü–ö–ê + -->
        <button onclick="openAddModal()" class="fixed bottom-6 right-6 w-14 h-14 btn-primary rounded-full shadow-lg flex items-center justify-center text-3xl font-light active:scale-90 transition-transform z-40">+</button>
    </div>

    <!-- üü¶ –ú–û–î–ê–õ–ö–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ï–î–´ (–ü–û–õ–ù–ê–Ø) -->
    <div id="modal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-end sm:items-center justify-center backdrop-blur-sm transition-opacity">
        <div class="bg-white w-full sm:w-96 rounded-t-2xl sm:rounded-2xl p-6 shadow-2xl" style="background-color: var(--tg-theme-bg-color);">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">–î–æ–±–∞–≤–∏—Ç—å –µ–¥—É</h3>
                <button onclick="closeModal()" class="text-gray-400 p-2">‚úï</button>
            </div>
            
            <!-- –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã -->
            <div class="mb-4">
                 <div class="text-[10px] font-bold opacity-50 uppercase mb-2 tracking-wider">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä</div>
                 <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                    <button onclick="fill('–Ø–±–ª–æ–∫–æ',52,0,0,14)" class="px-3 py-2 bg-gray-100 dark:bg-white/10 rounded-lg text-xs whitespace-nowrap">üçé –Ø–±–ª–æ–∫–æ</button>
                    <button onclick="fill('–ë–∞–Ω–∞–Ω',96,1,0,21)" class="px-3 py-2 bg-gray-100 dark:bg-white/10 rounded-lg text-xs whitespace-nowrap">üçå –ë–∞–Ω–∞–Ω</button>
                    <button onclick="fill('–ö–æ—Ñ–µ',40,2,2,4)" class="px-3 py-2 bg-gray-100 dark:bg-white/10 rounded-lg text-xs whitespace-nowrap">‚òïÔ∏è –ö–æ—Ñ–µ</button>
                    <button onclick="fill('–Ø–π—Ü–æ',70,6,5,0)" class="px-3 py-2 bg-gray-100 dark:bg-white/10 rounded-lg text-xs whitespace-nowrap">ü•ö –Ø–π—Ü–æ</button>
                    <button onclick="fill('–ö—É—Ä–∏—Ü–∞',165,31,3,0)" class="px-3 py-2 bg-gray-100 dark:bg-white/10 rounded-lg text-xs whitespace-nowrap">üçó –ö—É—Ä–∏—Ü–∞</button>
                </div>
            </div>

            <div class="space-y-3">
                <!-- –í–´–ë–û–† –ü–†–ò–ï–ú–ê –ü–ò–©–ò -->
                <select id="mealType" class="w-full p-3 rounded-xl border-0 bg-gray-100 dark:bg-white/5 outline-none font-medium">
                    <option value="breakfast">‚òïÔ∏è –ó–∞–≤—Ç—Ä–∞–∫</option>
                    <option value="lunch">üç≤ –û–±–µ–¥</option>
                    <option value="snack">üçè –ü–µ—Ä–µ–∫—É—Å</option>
                    <option value="dinner">ü•ó –£–∂–∏–Ω</option>
                </select>

                <!-- –ù–ê–ó–í–ê–ù–ò–ï -->
                <input type="text" id="mName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –ë–æ—Ä—â)" class="w-full p-3 rounded-xl border-0 bg-gray-100 dark:bg-white/5 outline-none font-medium">
                
                <!-- –ë–ñ–£ –ò –ö–ö–ê–õ (–í–ï–†–ù–£–õ –ü–û–õ–Ø!) -->
                <div class="grid grid-cols-4 gap-2">
                    <div class="col-span-1">
                        <label class="text-[10px] opacity-50 block mb-1 font-bold">–ö–ö–ê–õ</label>
                        <input type="number" id="inKcal" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-white/5 text-center font-bold outline-none">
                    </div>
                    <div class="col-span-1">
                        <label class="text-[10px] opacity-50 block mb-1">–ë–ï–õ–ö–ò</label>
                        <input type="number" id="inP" class="w-full p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-center outline-none">
                    </div>
                    <div class="col-span-1">
                        <label class="text-[10px] opacity-50 block mb-1">–ñ–ò–†–´</label>
                        <input type="number" id="inF" class="w-full p-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 text-center outline-none">
                    </div>
                    <div class="col-span-1">
                        <label class="text-[10px] opacity-50 block mb-1">–£–ì–õ–ò</label>
                        <input type="number" id="inC" class="w-full p-2 rounded-lg bg-green-50 dark:bg-green-900/20 text-center outline-none">
                    </div>
                </div>
            </div>
            
            <button onclick="addItem()" class="w-full mt-6 py-3.5 btn-primary rounded-xl font-bold text-lg shadow-lg active:scale-95 transition-transform">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- ‚öôÔ∏è –ú–û–î–ê–õ–ö–ê –ù–ê–°–¢–†–û–ï–ö (–¶–ï–õ–ò) -->
    <div id="settingsModal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 text-center shadow-2xl" style="background-color: var(--tg-theme-bg-color);">
            <h2 class="text-2xl font-bold mb-2">üéØ –¢–≤–æ—è —Ü–µ–ª—å</h2>
            <p class="text-sm opacity-60 mb-6">–£—Å—Ç–∞–Ω–æ–≤–∏ —Å—É—Ç–æ—á–Ω—ã–µ –Ω–æ—Ä–º—ã</p>
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="text-xs font-bold uppercase opacity-50 ml-1">–ö–∞–ª–æ—Ä–∏–∏</label>
                    <input type="number" id="setKcal" placeholder="2000" class="w-full mt-1 p-3 rounded-xl bg-gray-100 dark:bg-white/5 text-xl font-bold outline-none">
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="text-xs font-bold uppercase opacity-50 ml-1">–ë–µ–ª–∫–∏</label>
                        <input type="number" id="setP" placeholder="150" class="w-full mt-1 p-2 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-center outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold uppercase opacity-50 ml-1">–ñ–∏—Ä—ã</label>
                        <input type="number" id="setF" placeholder="60" class="w-full mt-1 p-2 rounded-xl bg-yellow-50 dark:bg-yellow-900/20 text-center outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold uppercase opacity-50 ml-1">–£–≥–ª–∏</label>
                        <input type="number" id="setC" placeholder="200" class="w-full mt-1 p-2 rounded-xl bg-green-50 dark:bg-green-900/20 text-center outline-none">
                    </div>
                </div>
            </div>
            
            <button onclick="saveSettings()" class="w-full mt-8 py-3.5 rounded-xl font-bold text-lg btn-primary shadow-lg active:scale-95 transition-transform">
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </div>
    </div>

    <script>
        // --- 1. –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ---
        const errConsole = document.getElementById('error-console');
        function logError(msg) {
            errConsole.style.display = 'block';
            errConsole.innerHTML += "üî¥ " + msg + "<br>";
            console.error(msg);
        }
        window.onerror = function(msg, url, line) { logError(msg + " (line " + line + ")"); };

        // --- 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        let data = {
            goals: { k: 2000, p: 150, f: 60, c: 200 },
            meals: []
        };
        let chart = null;

        // --- 3. –î–ê–¢–ê ---
        function getSelectedDateKey() {
            const pickerValue = document.getElementById('datePicker').value;
            if (!pickerValue) {
                const d = new Date();
                const y = d.getFullYear();
                const m = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `kbju_meals_${y}-${m}-${day}`;
            }
            return `kbju_meals_${pickerValue}`;
        }

        function setTodayInPicker() {
            const d = new Date();
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            document.getElementById('datePicker').value = `${y}-${m}-${day}`;
        }

        // --- 4. –ó–ê–ì–†–£–ó–ö–ê ---
        async function loadAllData() {
            try {
                // –¶–µ–ª–∏
                const savedGoals = localStorage.getItem('kbju_goals');
                if (savedGoals) {
                    data.goals = JSON.parse(savedGoals);
                } else {
                    setTimeout(() => openSettings(), 500);
                }
                // –ï–¥–∞
                await loadMealsForDate();
            } catch (e) {
                logError("Init error: " + e.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
            }
        }

        async function loadMealsForDate() {
            const container = document.getElementById('mealsContainer');
            container.style.opacity = '0.5';
            
            const key = getSelectedDateKey();
            data.meals = [];

            // LocalStorage
            const localRaw = localStorage.getItem(key);
            if (localRaw) {
                data.meals = JSON.parse(localRaw);
            }
            render(); 

            // CloudStorage
            tg.CloudStorage.getItem(key, (err, val) => {
                container.style.opacity = '1';
                if (!err && val) {
                    data.meals = JSON.parse(val);
                    render();
                }
            });
        }

        function changeDate() { loadMealsForDate(); }

        // --- 5. –°–û–•–†–ê–ù–ï–ù–ò–ï ---
        function saveMeals() {
            const key = getSelectedDateKey();
            const json = JSON.stringify(data.meals);
            localStorage.setItem(key, json);
            tg.CloudStorage.setItem(key, json);
            render();
        }

        function saveSettings() {
            const k = document.getElementById('setKcal').value;
            if(!k) { tg.showAlert("–í–≤–µ–¥–∏ –∫–∞–ª–æ—Ä–∏–∏!"); return; }

            data.goals = {
                k: Number(k),
                p: Number(document.getElementById('setP').value) || 150,
                f: Number(document.getElementById('setF').value) || 60,
                c: Number(document.getElementById('setC').value) || 200
            };

            const json = JSON.stringify(data.goals);
            localStorage.setItem('kbju_goals', json);
            tg.CloudStorage.setItem('kbju_goals', json);

            document.getElementById('settingsModal').classList.add('hidden');
            render();
            tg.HapticFeedback.notificationOccurred('success');
        }

        // --- 6. –û–¢–†–ò–°–û–í–ö–ê ---
        function render() {
            // –°—É–º–º—ã
            let totals = { k:0, p:0, f:0, c:0 };
            data.meals.forEach(m => {
                totals.k += m.k; totals.p += m.p; totals.f += m.f; totals.c += m.c;
            });

            // –í–µ—Ä—Ö–Ω–∏–µ –ø–æ–ª–æ—Å–∫–∏
            const left = data.goals.k - totals.k;
            document.getElementById('calLeft').innerText = left > 0 ? left : 0;
            updateBar('P', totals.p, data.goals.p);
            updateBar('F', totals.f, data.goals.f);
            updateBar('C', totals.c, data.goals.c);

            // –ì—Ä–∞—Ñ–∏–∫
            updateChart(totals.k, left > 0 ? left : 0);

            // –°–ø–∏—Å–æ–∫ –µ–¥—ã (–ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú)
            renderMealsList();
        }

        function renderMealsList() {
            const container = document.getElementById('mealsContainer');
            const emptyMsg = document.getElementById('emptyMsg');
            container.innerHTML = '';

            if (data.meals.length === 0) {
                emptyMsg.classList.remove('hidden');
                return;
            } else {
                emptyMsg.classList.add('hidden');
            }

            const categories = {
                'breakfast': '–ó–∞–≤—Ç—Ä–∞–∫ ‚òïÔ∏è', 'lunch': '–û–±–µ–¥ üç≤',
                'snack': '–ü–µ—Ä–µ–∫—É—Å üçè', 'dinner': '–£–∂–∏–Ω ü•ó'
            };

            for (let [key, label] of Object.entries(categories)) {
                const mealsInCat = data.meals.filter(m => m.type === key);
                if (mealsInCat.length === 0) continue;

                let html = `<div class="card p-4"><h3 class="font-bold mb-3 text-xs opacity-50 uppercase tracking-wide">${label}</h3>`;
                
                mealsInCat.forEach((meal) => {
                    const globalIndex = data.meals.indexOf(meal); // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –≤ –æ–±—â–µ–º –º–∞—Å—Å–∏–≤–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                    html += `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100 dark:border-white/5 last:border-0">
                            <div>
                                <div class="font-semibold text-sm">${meal.name}</div>
                                <div class="text-[11px] opacity-60 mt-0.5">üî• ${meal.k} ‚Ä¢ –ë${meal.p} –ñ${meal.f} –£${meal.c}</div>
                            </div>
                            <button onclick="removeMeal(${globalIndex})" class="text-red-400 p-2 active:scale-90 transition-transform">‚úï</button>
                        </div>
                    `;
                });
                html += `</div>`;
                container.innerHTML += html;
            }
        }

        function updateBar(type, val, max) {
            const pct = Math.min(100, (val/max)*100);
            document.getElementById(`val${type}`).innerText = val;
            document.getElementById(`goal${type}`).innerText = max;
            const bar = document.getElementById(`bar${type}`);
            bar.style.width = pct + "%";
            if(val > max) bar.classList.add('bg-red-500'); else bar.classList.remove('bg-red-500');
        }

        function updateChart(eaten, left) {
            const ctx = document.getElementById('caloriesChart');
            if(!ctx) return;
            const color = eaten > data.goals.k ? '#ef4444' : '#3b82f6';

            if(chart) {
                chart.data.datasets[0].data = [eaten, left];
                chart.data.datasets[0].backgroundColor[0] = color;
                chart.update();
            } else {
                chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['–ï–¥–∞', '–û—Å—Ç.'],
                        datasets: [{ data: [eaten, left], backgroundColor: [color, '#f3f4f6'], borderWidth: 0, borderRadius: 20, cutout: '85%' }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: false }, animation: { duration: 500 } }
                });
            }
        }

        // --- 7. UI –§–£–ù–ö–¶–ò–ò ---
        function openAddModal() { document.getElementById('modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        
        function openSettings() {
            document.getElementById('setKcal').value = data.goals.k;
            document.getElementById('setP').value = data.goals.p;
            document.getElementById('setF').value = data.goals.f;
            document.getElementById('setC').value = data.goals.c;
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function fill(n,k,p,f,c) {
            document.getElementById('mName').value = n;
            document.getElementById('inKcal').value = k;
            document.getElementById('inP').value = p;
            document.getElementById('inF').value = f;
            document.getElementById('inC').value = c;
            tg.HapticFeedback.selectionChanged();
        }

        function addItem() {
            const name = document.getElementById('mName').value;
            const k = Number(document.getElementById('inKcal').value);
            const type = document.getElementById('mealType').value;

            if(!name || !k) { tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∫–∞–ª"); return; }

            data.meals.push({
                type: type, // –í–∞–∂–Ω–æ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∏–ø (–∑–∞–≤—Ç—Ä–∞–∫/–æ–±–µ–¥...)
                name: name, 
                k: k,
                p: Number(document.getElementById('inP').value)||0,
                f: Number(document.getElementById('inF').value)||0,
                c: Number(document.getElementById('inC').value)||0
            });
            saveMeals();
            closeModal();
            // –û—á–∏—Å—Ç–∫–∞
            document.getElementById('mName').value = '';
            document.getElementById('inKcal').value = '';
            document.getElementById('inP').value = '';
            document.getElementById('inF').value = '';
            document.getElementById('inC').value = '';
        }

        function removeMeal(idx) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å?")) {
                data.meals.splice(idx, 1);
                saveMeals();
            }
        }

        function forceStart() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            setTodayInPicker();
            loadAllData();
        }

        window.onload = function() {
            setTodayInPicker();
            loadAllData();
        };

    </script>
</body>
</html>
